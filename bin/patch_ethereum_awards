# Run with:
# bundle exec rails runner bin/patch_ethereum_awards
# Or
# heroku run bundle exec rails runner bin/patch_ethereum_awards --app [appname]

STDOUT.print "Checking all awards"

Sidekiq::Queue.all.each(&:clear)
Sidekiq::RetrySet.new.clear
Sidekiq::ScheduledSet.new.clear
Sidekiq::Stats.new.reset
Sidekiq::DeadSet.new.clear

Project.find_each(batch_size: 1) do |project|
  if project.ethereum_enabled?
    project.awards.find_each(batch_size: 1) do |award|
      CreateEthereumAwards.call(award: award)
      STDOUT.print '.'
    end
  end
end

STDOUT.print "\nDone.\n"
