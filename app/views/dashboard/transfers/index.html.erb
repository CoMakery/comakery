<%= render layout: 'projects/project_settings' do %>
  <div data-controller="transfer-form sign--wallet-connect sign--metamask" data-transfer-form-decimal-places="<%= @project.token ? @project.token.decimal_places : 0 %>">
    <%= render partial: "filters" %>
    <turbo-frame id="chart-data" target="_top" src="<%= fetch_chart_data_project_dashboard_transfers_path(@project, duration: (params[:duration] || 'Year'), q: @filter_params, page: params[:page]) %>">
      <div class="centered"><%= image_tag 'spinner.gif' %></div>
    </turbo-frame>
    <div class="row">
      <div class="col-6">
        <% if policy(@project).create_transfer? %>
          <div class="transfers-filters">
            <div class="transfers-filters--filter">
              <div class="transfers-filters--filter--options">
                  <a href="#" class="btn btn-primary h12" data-bs-toggle="modal" data-bs-target="#modal-create-vesting-schedule">
                    Create New Transfer
                    <svg class="ms-1" width="9" height="5" viewBox="0 0 14 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path fill-rule="evenodd" clip-rule="evenodd" d="M0.292893 0.292893C-0.0976311 0.683417 -0.0976312 1.31658 0.292893 1.70711L6.29289 7.70711C6.68342 8.09763 7.31658 8.09763 7.70711 7.70711L13.7071 1.70711C14.0976 1.31658 14.0976 0.683418 13.7071 0.292894C13.3166 -0.0976305 12.6834 -0.0976305 12.2929 0.292894L7 5.58579L1.70711 0.292893C1.31658 -0.097631 0.683418 -0.0976311 0.292893 0.292893Z" fill="currentColor"></path>
                    </svg>
                  </a>
                <%= select 'select', 'transfers', {}, { include_blank: 'Create New Transfer' }, { data: { target: 'transfer-form.create', action: 'transfer-form#showForm' } } do %>
                  <%= options_from_collection_for_select(@project.transfer_types, 'id', 'name') %>
                  <% if policy(@project).transfer_types? %>
                    <%= tag.option 'Manage Categories', { 'data-url': project_dashboard_transfer_categories_path(@project) } %>
                  <% end %>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
      </div>

      <div class="col-6">
        <% hot_wallet = @project.hot_wallet %>
        <% if hot_wallet.present? %>
          <div class="text-right hot-wallet">
            <% if policy(@project).edit_hot_wallet_mode? %>
              <%= render partial: 'hot_wallet_mode', locals: { project: @project } %>
            <% else %>
              <div class="hot-wallet-address">
                Hot Wallet:&emsp; <%= link_to(
                  middle_truncate(hot_wallet.address),
                  hot_wallet.blockchain.url_for_address_human(hot_wallet.address),
                  target: :_blank,
                  class: 'mr-2',
                  data: { controller: "utils--truncate", target: "utils--clipboard.source", width: "300" }
                ) %>
              </div>
            <% end %>
        <% elsif policy(@project).edit_hot_wallet_mode? && @project.token&._token_type_on_ethereum? %>
          <div class="text-right hot-wallet">
            <h3>Deploy a hot wallet:</h3>
            <a href="<%= deploy_to_heroku_url(@project) %>" target="_blank">
              <img src="https://www.herokucdn.com/deploy/button.svg" alt="Deploy">
            </a>
          </div>
        <% end %>
      </div>
    </div>

    <% if policy(@project).create_transfer? %>
      <%= render partial: "shared/wallet_connect" %>
    <% end %>

    <% if policy(@project).create_transfer? && @project.token&.supports_batch_transfers? && ENV['ENABLE_BATCH_TRANSFERS_UI'] %>
      <div class="row">
        <div class="col-6">
          <%= render partial: "shared/transfer_button_batch" %>
        </div>
      </div>
    <% end %>

    <div class="transfers-table animated fadeIn faster">
      <%= render partial: "header" %>
      <%= render partial: "summary" %>
      <%= render partial: "form" %>
      <%= render partial: "transfer", collection: @transfers, as: :transfer, cached: false %>
    </div>

    <div class="transfers-pages">
      <%= paginate(@transfers, window: 3) %>
    </div>

    <%= render partial: "form2" %>
  </div>
<% end %>
